# How to use Eclipser on fuzzuf

## Usage

```
$ fuzzuf eclipser [options]
```

Eclipser is a gray-box concolic testing tool expected to run as a side car of AFL fuzzer. Eclipser retrieves branch condition using QEMU based tracer and find change of branch operand values that depends on inputs. The algorithm first try to describe relation between inputs and operand values in linear equation. If that fit, the input value causing pass the branch is generated by the linear equation. Otherwise, the algorithm try to find input value causing pass the branch by binary search. This expects that the relation of the input and operand values is monotonic. Monotonic means, during the input value is increasing or decreasing in one direction, the operand value will change in one direction or stay in same value. If relation of inputs and operand values is not linear nor monotonic, the algorithm fail to generate the input value that can pass the branch. Although, Eclipser may fail to generate an appropriate input, as combined fuzzer generates randomly mutated inputs to take over, the failure is not critical.

Since the algorithm instrument binary dynamically using QEMU, PUT need not to be built using special compiler to insert instrumentation. The patch for QEMU is implemented intrusively in the i386 to TCG translator. This causes Eclipser only works for x86 or x86\_64 binaries.

Basic usage is shown below.

```
$ ./fuzzuf eclipser --out_dir <SYNCDIR>/eclipser -s <SYNCDIR> --program <PUT> --noforkserver --filepath <INPUT_FILE_PATH> --arg <INPUT_FILE_PATH> -v 2
```

SYNCDIR is a directory the combined fuzzer is reading and writing the state(typically called "sync dir" in AFL like fuzzer). In the configuration avobe, Eclipser writes it's own state in \<SYNCDIR\>/eclipser, and reads input values generated by others from directories in \<SYNCDIR\> excluding \<SYNCDIR\>/eclipser.

PUT is a path to the executable to run.

Eclipser writes current input value to the file \<INPUT\_FILE\_PATH\>.  If the --filepath is not set, Eclipser pass the input value over standard input.

--noforkserver disables fork server mode.

-v specifies the verbosity. 2 means output all messages. 1 means output only important messages. 0 means no messages.


## Options

Note that some options have short arg name which conflict with global options. Those short names
cannot be used in fact.

### --verbose arg 

Verbosity level to control debug messages in integer

| arg   | effect                          |
|------:|---------------------------------|
|     0 | disable messages                |
|     1 | output found seeds              |
|     2 | output found seeds and progress | 

### --timeimit arg

Timeout for fuzz testing (in seconds).
If the value is set to positive, Eclipser will exit after the specified seconds.
If the value is set to zero, Eclipser will exit immediately.
If the value is set to negative, Eclipser will not exit.
Default value is -1.

### --outputdir arg

Directory to store testcase outputs.
The seeds eclipser found are written under the directory.
If not set, global output directory is used.

### --syncdir arg

Mandatory option.
Directory shared with AFL instances.
The directory containing all fuzzing processes state.
This directory is called "sync dir" in AFL term.
To make other processes can retrieve eclipser generated seeds, --outputdir need to be located under the --syncdir.

### --program arg

Mandatory option.
Target program for test case generation with fuzzing.

### --exectimeout arg

Execution timeout (ms) for a fuzz run.
If the PUT execution time exceed this, PUT is terminated and the execution result is marked as "timeout".
Default value is 500milliseconds.

### --architecture arg

Target program architecture (x86|x64)

| arg   | effect                      |
|------:|-----------------------------|
|   x86 | Execute PUT on qemu-i386    |
|   x64 | Execute PUT on qemu-x86\_64 |

Default value is x64

### --noforkserver

Do not use fork server for target program execution.

### --inputdir arg

Directory containing initial seeds.
This value is not used.

### --arg arg

Command-line argument of the target program to fuzz.
The argument is splitted by space.
There is no escape sequence to pass space itself as an argument.
Default value is empty.

### --filepath arg

If the arg is set, the input value eclipser generated is written into the specified file before it executes PUT.
Otherwise, the input value is written to the standard input of PUT.

### --nsolve arg

Number of branches to flip in grey-box concolic testing when an execution path is given. 'N\_solve' parameter in the paper.
Default value is 600.

### --nspawn arg

Number of byte values to initially spawn in grey-box concolic testing. 'N\_spawn' parameter in the paper.
Default value is 10.

